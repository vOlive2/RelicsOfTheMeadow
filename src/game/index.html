<div id="game-board"></div>

<div id="hud">
  <div id="faction-info">
    <h2 id="faction-name"></h2>
    <p id="stats"></p>
    <p id="relics"></p>
    <p id="energy"></p>
  </div>

  <div id="actions">
    <button data-action="declare-war">âš”ï¸ Declare War</button>
    <button data-action="battle">ğŸ©¸ Battle / Siege</button>
    <button data-action="fortify">ğŸ§± Fortify</button>
    <button data-action="build">ğŸ—ï¸ Build</button>
    <button data-action="trade">ğŸ’° Manage Trade</button>
    <button data-action="use-relic">ğŸ§¿ Use Relic</button>
    <button data-action="faction-abilities">ğŸŒŸ Faction Abilities</button>
    <button data-action="end-turn">ğŸŒ™ End Turn</button>
  </div>
</div>

<div id="event-log"></div>

<!-- Trade Popup -->
<div id="trade-popup" class="popup hidden">
  <h3>Trade Management</h3>
  <button data-trade="cut">Cut Trade (Free)</button>
  <button data-trade="expand">Expand Route (-25ğŸ’°)</button>
  <button data-trade="deal">Form Deal (-50ğŸ’°)</button>
  <button id="close-trade">Close</button>
</div>

<!-- Faction Abilities Popup -->
<div id="faction-popup" class="popup hidden">
  <h3>Faction Abilities</h3>
  <div id="faction-abilities-list"></div>
  <button id="close-faction">Close</button>
</div>

<script type="module">
  import { factions } from "../../data/factions.js";

  document.addEventListener("DOMContentLoaded", () => {
    // ğŸ§© Get chosen faction or default
    const chosenFactionName = localStorage.getItem("chosenFaction") || "The Crimson Horde";
    const faction = factions.find(f => f.name === chosenFactionName);

    // ğŸª Safety nets so nothing breaks
    const defaultTraits = faction?.defaultTraits || { prowess: 0, resilience: 0, economy: 0 };
    const relicList = Array.isArray(faction?.relics) ? faction.relics.join(", ") : "None";
    const energy = faction?.energy ?? 0;
    const gold = faction?.gold ?? 0;

    // ğŸ§¾ Update HUD
    document.getElementById("faction-name").textContent = faction
      ? `${faction.emoji} ${faction.name}`
      : "â“ Unknown Faction";

    document.getElementById("stats").textContent =
      `Prowess: ${defaultTraits.prowess} | Resilience: ${defaultTraits.resilience} | Economy: ${defaultTraits.economy}`;

    document.getElementById("relics").textContent = `Relics: ${relicList}`;
    document.getElementById("energy").textContent = `Energy: ${energy} âš¡ | Gold: ${gold} ğŸ’°`;

    // âš™ï¸ Hook up buttons
    document.querySelectorAll("#actions button").forEach(button => {
      button.addEventListener("click", () => handleAction(button.dataset.action));
    });

    // ğŸ’¥ Handle actions
    function handleAction(action) {
      const log = document.getElementById("event-log");
      let msg = "";

      switch (action) {
        case "declare-war": msg = "âš”ï¸ You declared war!"; break;
        case "battle": msg = "ğŸ©¸ Battle begins!"; break;
        case "fortify": msg = "ğŸ§± You strengthened your defenses."; break;
        case "build": msg = "ğŸ—ï¸ You built a new structure."; break;
        case "trade":
          document.getElementById("trade-popup").classList.remove("hidden");
          return;
        case "use-relic": msg = `ğŸ§¿ You used your relics: ${relicList}`; break;
        case "faction-abilities":
          document.getElementById("faction-popup").classList.remove("hidden");
          return;
        case "end-turn": msg = "ğŸŒ™ Turn ended."; break;
        default: msg = "ğŸ¤” Unknown action.";
      }

      log.textContent = msg;
    }

    // ğŸª¶ Close popups
    document.getElementById("close-trade").addEventListener("click", () => {
      document.getElementById("trade-popup").classList.add("hidden");
    });

    document.getElementById("close-faction").addEventListener("click", () => {
      document.getElementById("faction-popup").classList.add("hidden");
    });
  });
</script>
